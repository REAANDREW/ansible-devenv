# vim:ft=ansible:
- name: create HOME bin
  file: path=/home/vagrant/bin owner=vagrant group=vagrant state=directory
  remote_user: vagrant
  sudo: False

- name: download gimme
  get_url: dest=/home/vagrant/bin/gimme url=https://raw.githubusercontent.com/travis-ci/gimme/master/gimme
  remote_user: vagrant
  sudo: False

- name: make gimme executable
  shell: chmod +x /home/vagrant/bin/gimme
  remote_user: vagrant
  sudo: False

- name: Install go via gimme
  shell: /home/vagrant/bin/gimme {{ golang.version }}
  remote_user: vagrant
  sudo: False

- name: create GO HOME
  file: path=/home/vagrant/go owner=vagrant group=vagrant state=directory
  remote_user: vagrant
  sudo: False

- name: add golang PATH
  lineinfile: dest=/home/vagrant/.bashrc line="export GOPATH=$HOME/go" insertbefore="^#End of Paths" 
  remote_user: vagrant
  sudo: False

- name: add golang PATH bin to PATH
  lineinfile: dest=/home/vagrant/.bashrc line="export PATH=$PATH:$GOPATH/bin" insertbefore="^#End of Paths" 
  remote_user: vagrant
  sudo: False

- name: add gimme envs to the bashrc
  lineinfile: dest=/home/vagrant/.bashrc line="source ~/.gimme/envs/go{{ golang.version }}.env" insertbefore="^#End of Paths" 
  remote_user: vagrant
  sudo: False

- name: vim-settings
  lineinfile: dest=/home/vagrant/.vimrc line="{{ item }}" insertbefore="^\"End of Settings" 
  remote_user: vagrant
  sudo: False
  with_items:
    - 'let g:go_highlight_functions = 1'
    - 'let g:go_highlight_methods = 1'
    - 'let g:go_highlight_structs = 1'
    - 'let g:go_highlight_operators = 1'
    - 'let g:go_highlight_build_constraints = 1'
    - 'let g:go_fmt_command = \"goimports\"'
    - 'let g:go_fmt_fail_silently = 1'
    - 'let g:go_fmt_autosave = 0'

- name: vim-key-bindings
  lineinfile: dest=/home/vagrant/.vimrc line="{{ item }}" insertbefore="^\"End of Keybindings" 
  remote_user: vagrant
  sudo: False
  with_items:
    - 'au FileType go nmap <leader>f <Plug>(gofmt)'

- name: Source .bashrc
  shell: . ~/.bashrc
  remote_user: vagrant
  sudo: False
